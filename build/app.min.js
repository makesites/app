/**
 * @name app
 * 
 *
 * Version: 0.4.0 (Mon, 01 May 2023 04:50:14 GMT)
 * Source: 
 *
 * @author makesites
 * Distributed by [Makesites.org](http://makesites.org)
 *
 * @license Released under the MPL v2.0, AGPL v3.0 licenses
 */
class Collection{constructor(t,e){this.defaults={_synced:!1,autofetch:!1,cache:!1},this.model=Model,e=e||{},this.options=utils.extend({},this.defaults,e),this.initialize()}initialize(){if(this.options.cache){var t=this.cache();t&&this.add(t)}this.options.autofetch&&_.isEmpty(models)&&this.url&&this.fetch()}render(){}update(){}save(t,e){if(_.extend(this.models,t),e.success){var i=_.after(this.models.length,e.success);_.each(this.models,(function(t){t.save(null,{success:i})}))}}cache(){return Backbone.Collection.prototype.cache||!1}parse(t){var e=this;return setTimeout((function(){e.trigger("fetch")}),200),this.options.cache&&this.cache(t),t}output(){return this.toJSON()}isNew(){return!1===this.options._synced}isOnline(){return!!_.isUndefined(app)||app.state.online}}class Controller{constructor(t){this.routes={},this.data=new Model,this.defaults={api:!1,autostart:!0,location:!1,pushState:!1,p404:"/"},t=t||{},this.options=utils.extend({},this.defaults,t),this.routes={"":"index","_=_":"_fixFB","access_token=:token":"access_token",logout:"logout"},this.state={fullscreen:!1,online:navigator.onLine,browser:function(){return/chrome/.test(navigator.userAgent.toLowerCase())?"chrome":/firefox/.test(navigator.userAgent.toLowerCase())?"firefox":/safari/.test(navigator.userAgent.toLowerCase())?"safari":"Microsoft Internet Explorer"==navigator.appName?"ie":/android/.test(navigator.userAgent.toLowerCase())?"android":/(iPhone|iPod).*OS 5.*AppleWebKit.*Mobile.*Safari/.test(navigator.userAgent)?"ios":-1!==navigator.userAgent.indexOf("Opera Mini")?"opera-mini":"other"},mobile:navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i),ipad:null!==navigator.userAgent.match(/iPad/i),retina:window.retina||window.devicePixelRatio>1,touch:"ontouchstart"in document.documentElement,pushstate:function(){try{return window.history.pushState({pageTitle:document.title},document.title,window.location),!0}catch(t){return!1}},scroll:!0,ram:function(){return console.memory?Math.round(console.memory.usedJSHeapSize/console.memory.totalJSHeapSize*100):0},standalone:function(){return"standalone"in navigator&&navigator.standalone||"undefined"!=typeof PhoneGap&&!_.isUndefined(PhoneGap.env)&&PhoneGap.env.app||"undefined"!=typeof external&&"function"==typeof external.msIsSiteMode&&external.msIsSiteMode()},framed:top!==self},this.initialize()}initialize(){this._setup()}update(){(this.state instanceof Backbone.Model?this.state.get("scroll"):this.state.scroll)?$("body").removeClass("no-scroll"):$("body").addClass("no-scroll")}index(){}logout(){this.session&&this.session.trigger("logout",{reload:!0}),this.navigate("/",!0)}preRoute(t,e){var i=this;return this.session&&void 0!==this.session.state?this.session.state?e.apply(i,t):this.session.bind("loaded",_.once((function(){e.apply(i,t)}))):e.apply(i,t)}access_token(t){this.session?this.session.set({token:t}):window.access_token=t,this.navigate("/",!0)}_setup(){this.options.api&&this._ajaxPrefilter(this.options.api),this.options.location&&this._geoLocation(),this._setupSession()}_setupSession(){}_ajaxPrefilter(t){var e=this.session||!1;$.ajaxPrefilter((function(i,s,n){if("json"==s.dataType){0===i.url.search(/^http/)||(i.url=t+i.url),i.xhrFields={withCredentials:!0};var o=e&&(e._csrf||e.get("_csrf"))||!1;o&&n.setRequestHeader("X-CSRF-Token",o)}}))}_fixFB(){this.navigate("/",!0)}_layoutUpdate(t){this.layout&&this.layout.trigger("update",{navigate:!0,path:t})}_bindRoutes(){if(this.routes){this.routes=_.result(this,"routes");for(var t,e=_.keys(this.routes);void 0!==(t=e.pop());){var i=this.routes[t];this.route(t,i,this._callRoute(this[i]))}}}_callRoute(t){return function(){this.preRoute.call(this,arguments,t)}}_geoLocation(){var t=this;navigator.geolocation.getCurrentPosition((function(e){t.state.location=e}),(function(){console.log("error",arguments)})),setTimeout((function(){t._geoLocation()}),3e4)}_404(t){var e="Unable to find path: "+t;console.log(e),this.navigate(this.options.p404)}}class Model{constructor(t,e){this.defaults={autofetch:!1,cache:!1},e=e||{},this.options=utils.extend({},this.defaults,e),this.initialize()}initialize(){if("object"==typeof model&&this.set(model),this.options.cache){var t=this.cache();t&&this.set(t)}this.options.autofetch&&!utils.isUndefined(this.url)&&this.fetch()}add(t){var e=this,i={};_.each(t,(function(t,s){_.isUndefined(e.get(s))&&(i[s]=t)})),this.set(i)}reset(){return this.clear().set(this.defaults)}cache(){return!!Model.cache&&Model.cache()}isOnline(){return!!_.isUndefined(app)||app.state.online}getValue(t,e){return t&&t[e]?_.isFunction(t[e])?t[e]():t[e]:null}parse(t){var e=this;return setTimeout((function(){e.trigger("fetch")}),200),this.options.cache&&this.cache(t),t}output(){return this.toJSON()}}class View{constructor(t){this.state=new Model,this.state.set({loaded:!1,scroll:!1,visible:!1}),this.states={scroll:"_scroll"},this.defaults={data:!1,html:!1,template:!1,url:!1,bind:"add remove reset change",type:!1,parentEl:!1,autoRender:!0,inRender:!1,silentRender:!1,renderTarget:!1,saveOptions:!0},this.events={"click a[rel='external']":"clickExternal"},t=t||{},this.options=utils.extend({},this.defaults,t),this.initialize()}initialize(){var t=this;$(this.el).unbind(),this.options.saveOptions&&(this.options=_.extend(this.options,options)),this.data=this.data||this.model||this.collection||null,this.options.data=!_.isNull(this.data),this.on("loaded",this.onLoaded),this.on("loaded",this._onLoaded),this.options.attr?$(this.el).attr("data-view",this.options.attr):$(this.el).removeAttr("data-view");var e=this.options.html?this.options.html:null,i=this.options.template||void 0===APP?this.options.template:APP.Template||!1;this.url&&!this.options.url&&(this.options.url=this.url);var s=this._url(options);this.url=this._url,i?(this.options.type||(this.options.type="default"),this.template="function"==typeof i?new i(e,{url:s}):i,t.options.autoRender&&this.template.bind("loaded",this.render)):s?$.get(s,(function(e){t.template=_.template(e),t.options.autoRender&&t.render()})):(this.template=_.template(e),t.options.autoRender&&this.render()),this.options.data&&!_.isUndefined(this.data.on)&&this.data.on(this.options.bind,this.render),this._initRender()?this.render():this.trigger("loaded"),$(window).bind("resize",_.bind(this._resize,this)),this.initStates()}initStates(){for(var t in this.states){var e=this.states[t];this.bind(t,_.bind(this[e],this))}}_url(t){var e=(t=t||{}).url||this.options.url;return"function"==typeof e?e():e}preRender(){}render(){if(this.template){this._preRender();var t,e=this._getTemplate(),i=this.toJSON(),s=e instanceof Function?e(i):e,n=this._findContainer();this.el||(t=$(s),this.el=this.$el=t),this._inDOM(),this.options.append?(t=t||$(s),n.append(t)):this.options.prepend?(t=t||$(s),n.prepend(t)):n.html(s),this._postRender()}}postRender(){}listen(t,e,i){var s="string"==typeof e?[e]:e;for(var n in s)t.bind(s[n],i)}resize(t){}clickExternal(t){t.preventDefault();var e=this.findLink(t.target);"undefined"!=typeof pageTracker&&(e=pageTracker._getLinkerUrl(e));try{window.plugins.childBrowser.showWebPage(e)}catch(t){window.open(e,"_blank")}return!1}clickTab(t){t.preventDefault();var e=this.findLink(t.target);$(this.el).find(e).show().siblings().hide(),$(t.target).parent("li").addClass("selected").siblings().removeClass("selected")}findLink(t){return"A"!=t.tagName?$(t).closest("a").attr("href"):$(t).attr("href")}remove(){$(window).unbind("resize",this._resize),Backbone.View.prototype.remove.call(this)}unbind(t,e){return this.off(t,null,e)}toJSON(){var t=this._toJSON();return this.options.inRender?{data:t,options:this.options}:t}onLoaded(){}parent(t,e){t=t||"",e=e||{},this.__inherit=this.__inherit||[];var i=(this.__inherit[t]||this._parent||{}).prototype||Object.getPrototypeOf(this).constructor.__super__,s=i[t]||function(){delete this.__inherit[t]},n=e instanceof Array?e:[e];return this.__inherit[t]=i._parent||function(){},s.apply(this,n)}_initRender(){if(!this.options.autoRender)return!1;var t=this._getTemplate(),e=this.options.html||this.options.url&&t,i=this.options.data&&(_.isUndefined(this.data.toJSON)||!_.isUndefined(this.data.toJSON)&&!_.isEmpty(this.data.toJSON()));return!(!e||!i)||(!(!e||this.options.data)||!(!i||this.options.url))}_preRender(){this.preRender()}_postRender(){this.options.silentRender||$(this.el).show(),(!this.options.data||this.options.data&&!_.isEmpty(this._toJSON()))&&($(this.el).removeClass("loading"),this.state.set("loaded",!0),this.trigger("loaded")),this.postRender()}_toJSON(){return this.options.data?this.data.toJSON?this.data.toJSON():this.data:{}}_getTemplate(){return this.options.type?this.template.get(this.options.type):this.template}_onLoaded(){this.setElement(this.el)}_findContainer(){var t=this.el;return this.options.renderTarget&&("string"==typeof this.options.renderTarget?(t=$(this.el).find(this.options.renderTarget).first()).length||(t=$(this.options.renderTarget).first()):"object"==typeof this.options.renderTarget&&(t=this.options.renderTarget)),t instanceof jQuery?t:$(t)}_inDOM(t){if(!(t=t||this.$el))return!1;var e=this.options.parentEl||"body";if($(this.options.parentEl).find(t).length)return!0;this.options.parentPrepend?$(e).prepend(t):$(e).append(t)}_navigate(t){}_resize(){var t,e=this,i=arguments;clearTimeout(t),t=setTimeout((function(){e.resize.apply(e,Array.prototype.slice.call(i))}),1e3)}_scroll(){}isVisible(){var t=jQuery(window).width(),e=jQuery(window).height(),i=jQuery(document).scrollTop(),s=jQuery(document).scrollLeft(),n=i,o=i+e,r=s,a=s+t,h=$(this.el).offset(),l=h.top>=n&&h.top<o&&h.left>=r&&h.left<a;return l&&!this.state.get("visible")?this.trigger("visible"):this.trigger("hidden"),this.state.set("visible",l),l}}class Layout extends View{constructor(t){this.el="body",this.defaults={autosync:!1,autorender:!0,sync_events:"add remove change"},this.events={"click a:not([rel='external'],[rel='alternate'])":"_clickLink"},t=t||{},this.options=_.extend({},this.defaults,t),this.initialize()}initialize(){if(this.views=new Model,$(this.el).unbind(),_.bindAll(this,"set","get","render","update","_clickLink","_viewLoaded","_syncData"),this.on("update",this.update),this.options.url||this.url){var t=this.options.url||this.url;this.options.type||(this.options.type="default"),this.template=new APP.Template(null,{url:t}),this.options.autorender&&this.template.bind("loaded",this.render)}options.data&&(this.data=options.data)}preRender(){}render(){if(this._preRender(),$(this.el).removeClass("loading"),this.template){var t=(this.options.type?this.template.get(this.options.type):this.template)(this.options);$(this.el).html(t)}this._postRender()}postRender(){}update(t){if((t=t||!1)&&t.navigate)for(var e in this.views.attributes)this.views.attributes[e]._navigate(t)}set(t){for(var e in t)t[e].on("loaded",_.bind(this._viewLoaded,this)),t[e]._name=e,t[e].data&&(t[e].data._view=e,t[e].data.on(this.options.sync_events,_.bind(this._syncData,this)));return this.views.set(t)}get(t){return this.views.get(t)}remove(t){var e=this.get(t);if(!_.isUndefined(e))return e.remove(),this.views.unset(t)}findLink(t){var e="A"!=t.tagName?$(t).closest("a"):$(t),i=e.attr("href"),s=!!i&&("#"==i.substr(0,1)||"/#"==i.substr(0,2)&&"/"==window.location.pathname);return!(_.isEmpty(i)||s||e.attr("target"))&&i}_preRender(){app.state.touch&&$(this.el).addClass("touch"),this.preRender()}_postRender(){this.postRender()}_viewLoaded(){var t=0,e=0;_.each(this.views.attributes,(function(i){i.state.loaded&&e++,t++})),t==e&&this._allViewsLoaded()}_allViewsLoaded(){return _.once((function(){this.render()}))}_syncData(t,e,i){var s=!1,n=e||t||!1;if(n){var o=n._view||!1;if(o&&this.model instanceof Backbone.Model){if(-1==(this.model.keys()||[]).indexOf(o))return;try{s=n.output()}catch(t){s=n.toJSON()}if(s){var r={};r[o]=s,this.model.set(r),this.options.autosync&&this.model.save()}}}}_clickLink(t){var e=this.findLink(t.target);if(e&&$(this.el).addClass("loading"),app.state.standalone()&&e)return t.preventDefault(),window.location=e,!1}}class Template extends Model{constructor(t,e){this.initialize()}initialize(){_.bindAll(this,"fetch","parse");options||(options={});_.isEmpty(html)||(this.set("default",this.compile(html)),this.trigger("loaded")),options.url&&(this.url=options.url,this.fetch())}compile(t){return _.template(t)}fetch(){$.get(this.url,this.parse)}parse(t){var e,i=this;try{e=$(t).filter("script")}catch(t){e=[]}e.length?e.each((function(){var t=$(this);t.attr("type").indexOf("template")>=0&&i.set(t.attr("id"),i.compile(t.html()))})):this.set("default",i.compile(t)),this.trigger("loaded")}}class Utils{constructor(){this.templateSettings={interpolate:/\{\{(.+?)\}\}/g,variable:"."},"undefined"!=typeof Handlebars&&_.mixin({template:Handlebars.compile})}extend(){var t=Array.prototype.slice.call(arguments),e={};for(var i in t){var s=t[i];for(var n in s)s[n]&&s[n].constructor&&s[n].constructor===Object?(e[n]=e[n]||{},e[n]=utils.extend.caller(e[n],s[n])):e[n]=s[n]}return e}isPhonegap(){return"undefined"!=typeof PhoneGap&&void 0!==PhoneGap.init&&void 0!==PhoneGap.env&&PhoneGap.env.app}isUndefined(t){return void 0===t}}class APP{constructor(){this.name="APP",this._routes=[],this.Models={},this.Controllers={},this.Collections={},this.Views={},this.Layouts={},this.Templates={};var t=arguments[0]||{},e=arguments[1]||function(){};t.require=t.require||"function"==typeof define&&define.amd,t.routePath="app/controllers/",t.pushState=t.pushState||!1;var i=!1,s=window.location.pathname.split("/");if(""===s[0]&&s.shift(),t.require){var n=t.routePath+"default";return"string"==typeof t.require?i=t.require:(i=t.routePath,i+=_.isEmpty(s[0])?"default":s[0]),require([i],(function(t){t&&e(t)}),(function(t){if((t.requireModules&&t.requireModules[0])!=i)throw t;require([n],(function(t){e(t)}))})),APP}for(var o in s)if(""!==s[o]&&(i=s[o].charAt(0).toUpperCase()+s[o].slice(1),"function"==typeof this.Controllers[i]))break;return i&&this.Controllers[i]?new this.Controllers[i](t):new Controller(t)}routes(){return this._routes}ready(t){return utils.isPhonegap()?PhoneGap.init(t):$?$(document).ready(t):window.addEventListener?window.addEventListener("load",t,!1):window.attachEvent("onload",t)}}APP.Model=Model,APP.View=View,APP.Controller=Controller,APP.Collection=Collection,APP.Layout=Layout;var utils=new Utils;window&&(window.APP=APP);export{APP,Collection,Controller,Layout,Model,Template,View};